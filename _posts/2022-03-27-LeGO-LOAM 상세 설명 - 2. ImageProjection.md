---
layout: post
title: LeGO-LOAM 상세 설명 - 2. ImageProjection
subtitle: Introduction
tags: [SLAM, LiDAR, Pointcloud, ROS, PCL, LeGO-LOAM]
comments: true

---

# imageProjection in LeGO-LOAM



최근 LiDAR sensor로 취득한 3D point cloud에서 feature extraction을 어떻게 뽑는가에 대한 관심이 생겨서, LeGO-LOAM을 자세히 보게 되었습니다.

그런데 찾아보는 도중, 크게 3가지 문제점에 대해 깨달아서 제가 한 번 정리해보고자 이렇게 글을 쓰게 되었습니다.

* Overview에 대한 설명 자료는 많으나, line-by-line으로 자세한 설명으로 되어있는 한글 문서가 없음 (주로 중국어(!)로 되어있음)
* LeGO-LOAM의 코드가 생각보다 휴리스틱한 부분과 하드코딩이 많아서, 처음 SLAM을 공부하는 이들이 LeGO-LOAM 코드를 바이블 삼아 공부하기에는 진입장벽이 높을 것 같음 (본인 포함)
* 논문 상에서 *LM방법으로 optimization을 했다*고만 적혀 있지, 실제 odometry를 추정하는 코드 내에서 jacobian을 직접 하나하나 구해서 짜져 있어서, 수학적 이해없이 코드를 이해하기 상당히 어려움

그래서 제가 이해한 것을 바탕으로 line-by-line으로 정리하고자 합니다.

LOAM과 LeGO-LOAM의 지식이 전혀 없으신 분은 진용이 형이 예전에 발표하셨던 [여기](https://www.youtube.com/watch?v=snPzNmcbCCQ&t=1589s)를 한번 보고 오시면 좋을 듯합니다.


## Overview

```c++
void cloudHandler(const sensor_msgs::PointCloud2ConstPtr& laserCloudMsg){
    // 1. Convert ros message to pcl point cloud
    copyPointCloud(laserCloudMsg);
    // 2. Start and end angle of a scan
    findStartEndAngle();
    // 3. Range image projection
    projectPointCloud();
    // 4. Mark ground points
    groundRemoval();
    // 5. Point cloud segmentation
    cloudSegmentation();
    // 6. Publish all clouds
    publishCloud();
    // 7. Reset parameters for next iteration
    resetParameters();
}

```
## 핵심 변수들

```
cv::Mat rangeMat; // range matrix for range image
cv::Mat labelMat; // label matrix for segmentaiton marking
cv::Mat groundMat; // ground matrix for ground cloud marking

// in `resetParameters()`
rangeMat = cv::Mat(N_SCAN, Horizon_SCAN, CV_32F, cv::Scalar::all(FLT_MAX));
groundMat = cv::Mat(N_SCAN, Horizon_SCAN, CV_8S, cv::Scalar::all(0));
labelMat = cv::Mat(N_SCAN, Horizon_SCAN, CV_32S, cv::Scalar::all(0));
```


## findStartEndAngle();
-118.59
259.08

-100.85
276.93

-82.98
294.76

-65.16
312.58

-47.33
330.62

-29.3
348.7

-11.22
366.56


6.66
384.53

24.63
402.56


42.61
420.44

60.51
438.03

78.08
455.49

---

LeGO-LOAM의 line-by-line 설명 시리즈입니다.
