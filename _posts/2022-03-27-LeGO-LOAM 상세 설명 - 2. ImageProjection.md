---
layout: post
title: LeGO-LOAM 상세 설명 - 2. ImageProjection
subtitle: Introduction
tags: [SLAM, LiDAR, Pointcloud, ROS, PCL, LeGO-LOAM]
comments: true

---

# ImageProjection in LeGO-LOAM

`imageProjection.cpp`에서는 3D LiDAR sensor로 취득한 point cloud를 range image로 projection을 한 후에, preprocessing을 진행한다. 이는 `featureAssociation.cpp`에서 향후 t-1와 t의 3D point cloud를 입력으로 relative pose를 구할 때 용이하게 해준다.

각 3D point cloud가 들어오면 아래와 같은 `cloudHandler` callback이 실행되고, 아래와 같이 7 step으로 구성되어 있다.

## Overview

```c++
void cloudHandler(const sensor_msgs::PointCloud2ConstPtr& laserCloudMsg){
    // 1. Convert ros message to pcl point cloud
    copyPointCloud(laserCloudMsg);
    // 2. Start and end angle of a scan
    findStartEndAngle();
    // 3. Range image projection
    projectPointCloud();
    // 4. Mark ground points
    groundRemoval();
    // 5. Point cloud segmentation
    cloudSegmentation();
    // 6. Publish all clouds
    publishCloud();
    // 7. Reset parameters for next iteration
    resetParameters();
}

```
## 핵심 변수들

```
cv::Mat rangeMat; // range matrix for range image
cv::Mat labelMat; // label matrix for segmentaiton marking
cv::Mat groundMat; // ground matrix for ground cloud marking

// in `resetParameters()`
rangeMat = cv::Mat(N_SCAN, Horizon_SCAN, CV_32F, cv::Scalar::all(FLT_MAX));
groundMat = cv::Mat(N_SCAN, Horizon_SCAN, CV_8S, cv::Scalar::all(0));
labelMat = cv::Mat(N_SCAN, Horizon_SCAN, CV_32S, cv::Scalar::all(0));
```


## findStartEndAngle();
-118.59
259.08

-100.85
276.93

-82.98
294.76

-65.16
312.58

-47.33
330.62

-29.3
348.7

-11.22
366.56


6.66
384.53

24.63
402.56


42.61
420.44

60.51
438.03

78.08
455.49

---

LeGO-LOAM의 line-by-line 설명 시리즈입니다.
