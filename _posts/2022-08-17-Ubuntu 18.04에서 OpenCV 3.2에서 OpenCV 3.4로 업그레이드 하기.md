---
layout: post
title: Ubuntu 18.04에서 OpenCV 3.2에서 OpenCV 3.4로 업그레이드 하기
subtitle: 사경을 해메는 OpenCV 버전 업그레이드
tags: [OpenCV, Ubuntu, ROS]
comments: true
---

# 시작의 근원

r3live를 돌려보려고 했는데, OpenCV *We have successfully test our algorithm with version 3.3.1, 3.4.16, 4.2.1 and 4.5.3* 라고 적혀있는 것을 확인하였다. 하지만 ROS를 설치할 때 자동으로 깔리는 버전이 3.2이기 때문에, 인위적으로 업데이트를 할 필요성을 느꼈다. 

다들 알겠지만, 컴퓨터를 포맷한 후 설치하는 것은 그리 어렵지 않으나, **깔려져 있는 상태에서 제거 후 재설치를 하는 것은 쉽지 않다.** 성공하기는 했는데 미래의 내가 분명히 다시 시행착오를 겪을 것 같아 미리 정리해둔다. 

(Tips. 연구실 비전쟁이들에게 물어본 결과 Ubuntu 18.04에서는 3.4, Ubuntu 20.04에서는 4.2를 주로 사용한다고 한다.

응창이 형의 [vins-application](https://github.com/engcang/vins-application) dependency 설치하는 것들이 아주 많이 도움이 되었다.


### 1. Version check & Remove existing OpenCV

아래의 명령어를 통해서 OpenCV의 버전 체크 가능

```
pkg-config --modversion opencv
```

확인 후, OpenCV를 전부다 지운다. 전부 지우는 명령어는 다음과 같다.

```
# In bash
sudo apt-get purge libopencv* python-opencv
# In zsh
sudo apt-get purge 'libopencv*' python-opencv
```
### 2. Install CUDA, CuDNN, and Ceres Solver

그 후, 필요한 dependency들을 설치해야 한다. 그 중 좀 거대한(?) dependency로는 CUDA, Cudnn, 그리고 Ceres solver가 있다.

#### CUDA, CuDNN

CUDA과 CuDNN은 다른 사이트에 잘 나와있으니 설치 방법에 대해서는 생략. CUDA와 CuDNN은 Ceres Solver보다 **먼저 설치하는 게 중요하다**. 왜냐하면 Ceres Solver 빌드 할때도 CUDA dependency가 있는 부분이 있기 때문이다. 

> CUDA If you have an NVIDIA GPU then Ceres Solver can use it accelerate the solution of the Gauss-Newton linear systems using the CMake flag USE_CUDA. Currently this support is limited to using the dense linear solvers that ship with CUDA. As a result GPU acceleration can be used to speed up DENSE_QR, DENSE_NORMAL_CHOLESKY and DENSE_SCHUR. This also enables CUDA mixed precision solves for DENSE_NORMAL_CHOLESKY and DENSE_SCHUR. Optional.

필요 없어 보인다고 느낄 수 있지만, SLAM이나 VINS에서는 이 sparse matrix를 solve할 때 위의 해당하는 함수들이 사용된다. 따라서 순서를 지키자.

#### Ceres Solver
그 후, Ceres solver는 [공식 사이트](http://ceres-solver.org/installation.html)를 보고 설치하면 된다.

버전 2가 나오긴 했는데, 아직은 조심스러우니 1.14.0를 계속 사용하는 것 같다. 따라서 2.1.0 버전을 설치하지말고 

```
wget http://ceres-solver.org/ceres-solver-1.14.0.tar.gz
``
로 1.14를 다운받자 (상세한 명령어는 [여기](http://ceres-solver.org/installation.html)). 

### 3. Install other dependencies

그 후, 나머지 OpenCV를 위한 것과 r3live를 위한 패키지들을 설치하자.
```




sudo apt-get install libcgal-dev pcl-tools
