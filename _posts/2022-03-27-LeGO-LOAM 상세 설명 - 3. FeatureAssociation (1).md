---
layout: post
title: LeGO-LOAM 상세 설명 - 3. FeatureAssociation (1)
subtitle: Feature Extraction
tags: [SLAM, LiDAR, Pointcloud, ROS, PCL, LeGO-LOAM]
comments: true
---

# FeatureAssociation in LeGO-LOAM (1) Feature Extraction

`featureAssociation.cpp`에서는 `imageProjection.cpp`에서 유효한 points들과 ground points를 추출한 후, 해당하는 값들로부터 (1) corner feature와 edge feature를 뽑고, (2) t-1과 t 사이의 relative odometry를 각 feature로부터 추정한다.

먼저 전체적으로 아래와 같이 200Hz로 (>10Hz) `runFeatureAssociation()` 함수를 계속 시행한다.

```cpp
int main(int argc, char** argv)
{
    ros::init(argc, argv, "lego_loam");

    ROS_INFO("\033[1;32m---->\033[0m Feature Association Started.");

    FeatureAssociation FA;

    ros::Rate rate(200);
    while (ros::ok())
    {
        ros::spinOnce();

        FA.runFeatureAssociation();

        rate.sleep();
    }
    
    ros::spin();
    return 0;
}
```

그리고 `runFeatureAssociation()` 함수는 아래와 같이 세 파트로 구성되어 있다.

```cpp
void runFeatureAssociation()
{
    /**
     0. Check whether the output of ImageProjection is coming or not
    */
    if (newSegmentedCloud && newSegmentedCloudInfo && newOutlierCloud &&
        std::abs(timeNewSegmentedCloudInfo - timeNewSegmentedCloud) < 0.05 &&
        std::abs(timeNewOutlierCloud - timeNewSegmentedCloud) < 0.05){

        newSegmentedCloud = false;
        newSegmentedCloudInfo = false;
        newOutlierCloud = false;
    }else{
        return;
    }
    /**
     1. Feature Extraction
    */
    adjustDistortion();

    calculateSmoothness();

    markOccludedPoints();

    extractFeatures();

    publishCloud(); // cloud for visualization

    /**
     2. Feature Association
    */
    if (!systemInitedLM) {
        checkSystemInitialization();
        return;
    }

    updateInitialGuess();

    updateTransformation();

    integrateTransformation();

    publishOdometry();

    publishCloudsLast(); // cloud to mapOptimization
}
```

## Feature Extraction

### adjustDistortion()

### calculateSmoothness()

### markOccludedPoints()

### extractFeatures()



 
---

LeGO-LOAM의 line-by-line 설명 시리즈입니다.
